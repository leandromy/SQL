-- DMFinanceiro.VW_CONSULTA_CARTEIRA_RECEBIVEIS source

CREATE  VIEW [DMFinanceiro].[VW_CONSULTA_CARTEIRA_RECEBIVEIS] AS
	SELECT
		DATEADD(DAY, 1, DATA_BAIXA) AS DATA_BAIXA
		,CLIENTE
		,NUMERO_PARCELA
		,DESC_TIPO_PARCELA
		,DESC_TIPO_RECEITA
		,VALOR_PAGO AS VALOR
		,DATA_VENCIMENTO
		,TABLE_NAME
		,SITUACAO = 'PAGA'
		, DATEADD( day, 1,EOMONTH(DATA_MOVIMENTO))  AS DATA_FECHAMENTO
	FROM [DMFinanceiro].[VW_CONSULTA_PARCELA] A
	--WHERE NUMERO_CONTRATO IN (32957, 45020)
	

	UNION

	SELECT 
		DATA_BASE
		,CLIENTE
		,NUMERO_PARCELA
		,DESC_TIPO_PARCELA
		,DESC_TIPO_RECEITA
		,VALOR
		,DATA_VENCIMENTO
		,TABLE_NAME
		--,CASE WHEN DATA_VENCIMENTO >= DATA_BASE THEN 'ABERTA' ELSE 'INADIMPLENTE' END AS SITUACAO	--removido o classificatÃ³rio de aberta/inadimp para puxar direto da view de inadimplencia - Renato Almeida 31/03/22
		,SITUACAO = 'ABERTA'
		,DATA_BASE AS DATA_FECHAMENTO
	FROM DMFinanceiro.VW_CONSULTA_CARTEIRA
	WHERE DATA_VENCIMENTO >= DATA_BASE
		AND DATA_BASE IN (
			'2019-01-01',
			'2019-02-01',
			'2019-03-01',
			'2019-04-01',
			'2019-05-01',
			'2019-06-01',
			'2019-07-01',
			'2019-08-01',
			'2019-09-01',
			'2019-10-01',
			'2019-11-01',
			'2019-12-01',
			'2020-01-01',
			'2020-02-01',
			'2020-03-01',
			'2020-04-01',
			'2020-05-01',
			'2020-06-01',
			'2020-07-01',
			'2020-08-01',
			'2020-09-01',
			'2020-10-01',
			'2020-11-01',
			'2020-12-01',		
			'2021-01-04',
			'2021-02-01',
			'2021-03-01',
			'2021-04-01',
			'2021-05-01',
			'2021-06-01',
			'2021-07-01',
			'2021-08-01',
			'2021-09-01',
			'2021-10-01',
			'2021-11-01',
			'2021-12-01',
			'2022-01-04',
			'2022-02-01',
			'2022-03-01'
		)

	UNION

	SELECT 
		DATA_BASE
		,CLIENTE
		,NUMERO_PARCELA
		,DESC_TIPO_PARCELA
		,DESC_TIPO_RECEITA
		,VALOR_INADIMPLENTE AS VALOR
		,DATA_VENCIMENTO
		,TABLE_NAME
		--,CASE WHEN DATA_VENCIMENTO >= DATA_BASE THEN 'ABERTA' ELSE 'INADIMPLENTE' END AS SITUACAO
		,SITUACAO = 'INADIMPLENTE'
		,DATA_BASE AS DATA_FECHAMENTO
	FROM DMFinanceiro.VW_CONSULTA_INADIMPLENCIA
	WHERE DATA_BASE IN (
			'2019-01-01',
			'2019-02-01',
			'2019-03-01',
			'2019-04-01',
			'2019-05-01',
			'2019-06-01',
			'2019-07-01',
			'2019-08-01',
			'2019-09-01',
			'2019-10-01',
			'2019-11-01',
			'2019-12-01',
			'2020-01-01',
			'2020-02-01',
			'2020-03-01',
			'2020-04-01',
			'2020-05-01',
			'2020-06-01',
			'2020-07-01',
			'2020-08-01',
			'2020-09-01',
			'2020-10-01',
			'2020-11-01',
			'2020-12-01',		
			'2021-01-04',
			'2021-02-01',
			'2021-03-01',
			'2021-04-01',
			'2021-05-01',
			'2021-06-01',
			'2021-07-01',
			'2021-08-01',
			'2021-09-01',
			'2021-10-01',
			'2021-11-01',
			'2021-12-01',
			'2022-01-04',
			'2022-02-01',
			'2022-03-01'
		);
